## 线程模型 TODO

https://mp.weixin.qq.com/s/oeOfsgF-9IOoT5eQt5ieyw

https://xiaolincoding.com/redis/base/redis_interview.html#redis-线程模型

### Redis单线程模型

<img src="https://cdn.jsdelivr.net/gh/iamk123/typora@main/uPic/2023/09/06/14455916939827591693982759078VIkHLl-14410716939824671693982467429OlM8Cl-8f7579b6cf7d4de5864b91eef30332c3~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="image.png" style="zoom: 67%;" />

```
Redis基于Reactor模式开发了自己的网络事件处理器，称之为文件事件处理器。
组成：Socket + IO多路复用程序 + 文件事件分派器 + 事件处理器

文件事件处理器：
- 连接应答处理器：用于处理客户端的连接请求
- 命令请求处理器：用于执行客户端传过来的命令。比如set、lpush等
- 命令回复处理器：用于返回客户端命令的执行结果。比如set、get的结果
```

[参考](https://juejin.cn/post/7093033045950726180)



### Redis 是单线程吗？

```
Redis 单线程指的是「接收客户端请求->解析 ->执行->内容返回」这个过程是由一个线程（主线程）来完成的

redis程序并不是单线程的，redis在启动时会启动后台线程（BIO）：
处理关闭文件、AOF 刷盘、释放内存（lazyfree 线程）

因为这些任务的操作都是很耗时的，如果把这些任务都放在主线程来处理，那么 Redis 主线程就很容易发生阻塞，这样就无法处理后续的请求了。
```

### Redis 单线程模式是怎样的？

```

```

### 讲讲Redis的线程模型？

```
https://mp.weixin.qq.com/s/CiFSsOx_g9g-0PUGXDuvcQ

https://javaguide.cn/database/redis/redis-questions-01.html#redis-%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B-%E9%87%8D%E8%A6%81
```

### Redis 采用单线程为什么还这么快？

```
单线程的 Redis 吞吐量可以达到 10W/每秒

Redis 采用单线程（网络 I/O 和执行命令）那么快，有如下几个原因：
（1）都在内存中完成，并且采用了高效的数据结构
（2）Redis 采用单线程模型可以避免了多线程之间的竞争，省去了多线程切换带来的时间和性能上的开销，而且也不会导致死锁问题。
（3）Redis 采用了 非阻塞的I/O 多路复用机制处理大量的客户端 Socket 请求。
IO 多路复用机制是指一个线程处理多个 IO 流，就是我们经常听到的 select/epoll 机制。简单来说，在 Redis 只运行单线程的情况下，该机制允许内核中，同时存在多个监听 Socket 和已连接 Socket。内核会一直监听这些 Socket 上的连接请求或数据请求。一旦有请求到达，就会交给 Redis 线程处理，这就实现了一个 Redis 线程处理多个 IO 流的效果。
#
```

### Redis 6.0 之前为什么使用单线程？

```
（1）单线程编程容易并且更容易维护；
（2）Redis 的性能瓶颈不在 CPU ，主要在内存和网络。CPU 并不是制约 Redis 性能表现的瓶颈所在，更多情况下是受到内存大小和网络I/O的限制，所以 Redis 核心网络模型使用单线程并没有什么问题
（3）增加了系统复杂度、同时可能存在线程切换、甚至加锁解锁、死锁造成的性能损耗。
（4）多线程会带来线程不安全的情况；
```

### Redis 6.0 之后为什么引入了多线程？

```
（1）单线程无法利用多CPU
（1）为了提高网络 IO 读写性能。因为随着网络硬件的性能提升，Redis 的性能瓶颈有时会出现在网络 I/O 的处理上，所以为了提高网络 I/O 的并行度，Redis 6.0 对于网络 I/O 采用多线程来处理。但是对于命令的执行，Redis 仍然使用单线程来处理
```

